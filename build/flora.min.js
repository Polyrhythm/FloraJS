/*
Copyright (C) 2012 Vince Allen
Brooklyn, NY 11215, USA

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
*/
/* Version: 1.0.0 */
/* Build time: October 8, 2012 03:42:42 */
var Flora={},exports=Flora;
(function(b){function n(){this._records=[]}function w(a){var c,d;c=a||{};a=b.config.defaultColorList;this.el=c.world||null;this.universeOptions=c.universeOptions||null;b.liquids=[];b.repellers=[];b.attractors=[];b.heats=[];b.colds=[];b.lights=[];b.oxygen=[];b.food=[];b.predators=[];b.mouse={loc:new b.Vector,locLast:new b.Vector};b.elementList=new b.ElementList;b.universe=new b.Universe(this.universeOptions);if("array"===b.Interface.getDataType(this.el)){c=0;for(d=this.el.length;c<d;c+=1)b.universe.addWorld({el:this.el[c]})}else b.universe.addWorld({el:this.el});
b.camera=new b.Camera;b.defaultColors=new b.ColorTable;c=0;for(d=a.length;c<d;c++)b.defaultColors.addColor({name:a[c].name,startColor:a[c].startColor,endColor:a[c].endColor});b.animLoop=function(){var a;a=b.universe;a.first();var c=b.elementList.all();if(a.isPlaying){window.requestAnimFrame(b.animLoop);a.zSorted&&(c=c.sort(function(a,c){return c.zIndex-a.zIndex}));for(a=c.length-1;0<=a;a-=1)c[a].step(),c[a]&&c[a].draw();b.universe.updateClocks()}}}function i(a,c){this.x=a||0;this.y=c||0}function u(){this._gradients=
[];this._colors=[]}function y(){}function z(){this._borders=[]}function p(a){var c,d,e,f=this,a=a||{};this.isPlaying=!1===a.isPlaying?!1:!0;this.zSorted=!!a.zSorted;this.showStats=!!a.showStats;this._records=[];this._statsDisplay=null;b.Utils.addEvent(document.body,"mousemove",function(a){b.mouse.locLast=b.mouse.loc.clone();b.mouse.loc=new b.Vector(a.pageX,a.pageY)});b.Utils.addEvent(document,"keyup",function(a){if(a.keyCode===b.config.keyMap.toggleWorldPlaystate)f.isPlaying=!f.isPlaying,f.isPlaying&&
window.requestAnimFrame(b.animLoop);else if(a.keyCode===b.config.keyMap.resetSystem){e=f.all();c=0;for(d=e.length;c<d;c+=1)b.elementList.destroyByWorld(e[c].id);b.FloraSystem.setup();f.isPlaying||(f.isPlaying=!0,window.requestAnimFrame(b.animLoop))}else a.keyCode===b.config.keyMap.toggleStatsDisplay&&(f._statsDisplay?f.destroyStats():f.createStats())});b.Utils.addEvent(document.body,"keydown",function(a){var c,d=b.elementList.all(),e,f,k,j;switch(a.keyCode){case b.config.keyMap.thrustLeft:a=0;for(c=
d.length;a<c;a++)d[a].keyControl&&(e=d[a],k=e.world.width/2,j=b.Utils.degreesToRadians(e.angle-e.turningRadius),f=k*Math.cos(j),k*=Math.sin(j),f=b.Vector.VectorAdd(new b.Vector(f,k),e.location),f=b.Vector.VectorSub(f,e.location),f.normalize(),f.mult(2*e.velocity.mag()),f=b.Vector.VectorSub(f,e.velocity),e.applyForce(f));break;case b.config.keyMap.thrustUp:a=0;for(c=d.length;a<c;a++)d[a].keyControl&&(e=d[a],k=e.world.width/2,j=b.Utils.degreesToRadians(e.angle),f=k*Math.cos(j),k*=Math.sin(j),f=new b.Vector(f,
k),f.normalize(),f.mult(e.thrust),f.limit(e.maxSpeed),d[a].applyForce(f));break;case b.config.keyMap.thrustRight:a=0;for(c=d.length;a<c;a++)d[a].keyControl&&(e=d[a],k=e.world.width/2,j=b.Utils.degreesToRadians(e.angle+e.turningRadius),f=k*Math.cos(j),k*=Math.sin(j),f=b.Vector.VectorAdd(new b.Vector(f,k),e.location),f=b.Vector.VectorSub(f,e.location),f.normalize(),f.mult(2*e.velocity.mag()),f=b.Vector.VectorSub(f,e.velocity),d[a].applyForce(f));break;case b.config.keyMap.thrustDown:a=0;for(c=d.length;a<
c;a++)d[a].keyControl&&d[a].velocity.mult(0.5)}});this.showStats&&this.createStats()}function m(a){var c=this,a=a||{},d=b.Utils.getWindowSize();this.isStatic=a.isStatic||!0;this.clock=a.clock||0;this.c=a.c||0.01;this.gravity=a.gravity||new b.Vector(0,1);this.wind=a.wind||new b.Vector;this.location=a.location||new b.Vector;this.scale=a.scale||1;this.angle=a.angle||0;this.opacity=a.opacity||1;this.colorMode=a.colorMode||"rgb";this.color=a.color||[0,0,0];this.borderWidth=a.borderWidth||0;this.borderStyle=
a.borderStyle||"none";this.borderColor=a.borderColor||null;this.borderRadius=a.borderRadius||0;this.boxShadow=a.boxShadow||0;this.zIndex=0;this.isTopDown=!0;this.compassAccuracy=this.compassHeading=0;this.isDeviceMotion=!a.isDeviceMotion;this.beforeStep=a.beforeStep||void 0;this.afterStep=a.afterStep||void 0;a.el?(this.el=a.el,this.id=this.el.id,this.width=this.el.offsetWidth,this.height=this.el.offsetHeight):(this.el=document.body,this.width=d.width,this.height=d.height,this.id=m.name+"-"+m._idCount);
this.el.className="world floraElement";this.el.style.width=this.width+"px";this.el.style.height=this.height+"px";m._idCount+=1;b.Utils.addEvent(window,"resize",function(){c.resize.call(c)})}function U(a){a=a||{};this.location=a.location||new b.Vector(0,0);this.controlObj=a.controlObj||null}function q(){var a,c,b,e;a=0;for(c=arguments.length;a<c;a+=1)for(b in e=arguments[a],e)e.hasOwnProperty(b)&&(this[b]=e[b])}function l(a){var a=a||{},c=b.elementList.all()||[],d=b.liquids||[],e=b.repellers||[],f=
b.attractors||[],g=b.heats||[],h=b.colds||[],r=b.predators||[],A=b.lights||[],i=b.oxygen||[],k=b.food||[],j,s=this.name||"anon";b.Obj.call(this,a);this.id=a.id||s.toLowerCase()+"-"+l._idCount;this.el=a.view&&"function"===b.Interface.getDataType(a.view)?a.view.call(this):"object"===b.Interface.getDataType(a.view)?a.view:document.createElement("div");j=this.world=a.world||b.universe.first();this.className=a.className||s.toLowerCase();this.className+=" floraElement";this.mass=a.mass||10;this.maxSpeed=
0===a.maxSpeed?0:a.maxSpeed||10;this.minSpeed=a.minSpeed||0;this.scale=0===a.scale?0:a.scale||1;this.angle=0===a.angle?0:a.angle||0;this.opacity=0===a.opacity?0:a.opacity||0.85;this.lifespan=0===a.lifespan?0:a.lifespan||-1;this.width=0===a.width?0:a.width||20;this.height=0===a.height?0:a.height||20;this.offsetDistance=0===a.offsetDistance?0:a.offsetDistance||30;this.offsetAngle=a.offsetAngle||0;this.colorMode=a.colorMode||"rgb";this.color=a.color||null;this.zIndex=0===a.zIndex?0:a.zIndex||10;this.pointToDirection=
!1===a.pointToDirection?!1:a.pointToDirection||!0;this.followMouse=!!a.followMouse;this.isStatic=!!a.isStatic;this.isDraggable=!!a.isDraggable;this.checkEdges=!1===a.checkEdges?!1:a.checkEdges||!0;this.wrapEdges=!!a.wrapEdges;this.avoidEdges=!!a.avoidEdges;this.avoidEdgesStrength=0===a.avoidEdgesStrength?0:a.avoidEdgesStrength||200;this.bounciness=0===a.bounciness?0:a.bounciness||0.75;this.maxSteeringForce=0===a.maxSteeringForce?0:a.maxSteeringForce||100;this.turningRadius=0===a.turningRadius?0:a.turningRadius||
90;this.thrust=0===a.thrust?0:a.thrust||5;this.flocking=!!a.flocking;this.desiredSeparation=0===a.desiredSeparation?0:a.desiredSeparation||2*this.width;this.separateStrength=0===a.separateStrength?0:a.separateStrength||0.3;this.alignStrength=0===a.alignStrength?0:a.alignStrength||0.2;this.cohesionStrength=0===a.cohesionStrength?0:a.cohesionStrength||0.1;this.sensors=a.sensors||[];this.flowField=a.flowField||null;this.acceleration=a.acceleration||new b.Vector;this.velocity=a.velocity||new b.Vector;
this.location=a.location||new b.Vector(j.width/2,j.height/2);this.controlCamera=!!a.controlCamera;this.beforeStep=a.beforeStep||void 0;this.afterStep=a.afterStep||void 0;c.push(this);this.el.id=this.id;this.el.className=this.className;j.el&&j.el.appendChild(this.el);l._idCount+=1;-1!==this.className.search("liquid")?d.push(this):-1!==this.className.search("repeller")?e.push(this):-1!==this.className.search("attractor")?f.push(this):-1!==this.className.search("heat")?g.push(this):-1!==this.className.search("cold")?
h.push(this):-1!==this.className.search("predator")?r.push(this):-1!==this.className.search("light")?A.push(this):-1!==this.className.search("oxygen")?i.push(this):-1!==this.className.search("food")&&k.push(this);this.controlCamera&&(b.camera.controlObj=this,j.location.x=-j.width/2+b.Utils.getWindowSize().width/2+(j.width/2-this.location.x),j.location.y=-j.height/2+b.Utils.getWindowSize().height/2+(j.height/2-this.location.y));this.isDraggable&&(b.Utils.addEvent(this.el,"mouseover",b.Obj.mouseover.bind(this)),
b.Utils.addEvent(this.el,"mousedown",b.Obj.mousedown.bind(this)),b.Utils.addEvent(this.el,"mousemove",b.Obj.mousemove.bind(this)),b.Utils.addEvent(this.el,"mouseup",b.Obj.mouseup.bind(this)),b.Utils.addEvent(this.el,"mouseout",b.Obj.mouseout.bind(this)))}function B(a){a=a||{};b.Mover.call(this,a);this.isPerlin=!1===a.isPerlin?!1:a.isPerlin||!0;this.remainsOnScreen=!!a.remainsOnScreen;this.perlinSpeed=a.perlinSpeed||0.0050;this.perlinTime=a.perlinTime||0;this.perlinAccelLow=a.perlinAccelLow||-0.075;
this.perlinAccelHigh=a.perlinAccelHigh||0.075;this.offsetX=a.offsetX||1E4*Math.random();this.offsetY=a.offsetY||1E4*Math.random();this.isRandom=!!a.isRandom;this.randomRadius=a.randomRadius||100;this.isHarmonic=!!a.isHarmonic;this.harmonicAmplitude=a.harmonicAmplitude||new b.Vector(4,0);this.harmonicPeriod=a.harmonicPeriod||new b.Vector(300,1);this.width=0===a.width?0:a.width||10;this.height=0===a.height?0:a.height||10;this.maxSpeed=0===a.maxSpeed?0:a.maxSpeed||30;this.wrapEdges=!!a.wrapEdges;this.isStatic=
!!a.isStatic}function C(a){a=a||{};b.Mover.call(this,a);this.initialLocation=a.initialLocation||new b.Vector(this.world.width/2,this.world.height/2);this.lastLocation=new b.Vector(0,0);this.width=0===a.width?0:a.width||10;this.height=0===a.height?0:a.height||10;this.amplitude=a.amplitude||new b.Vector(this.world.width/2-this.width,this.world.height/2-this.height);this.acceleration=a.acceleration||new b.Vector(0.01,0);this.aVelocity=new b.Vector(0,0);this.isStatic=!!a.isStatic;this.isPerlin=!!a.isPerlin;
this.perlinSpeed=a.perlinSpeed||0.0050;this.perlinTime=a.perlinTime||0;this.perlinAccelLow=a.perlinAccelLow||-2;this.perlinAccelHigh=a.perlinAccelHigh||2;this.perlinOffsetX=a.perlinOffsetX||1E4*Math.random();this.perlinOffsetY=a.perlinOffsetY||1E4*Math.random()}function D(a){a=a||{};b.Mover.call(this,a);this.lifespan=a.lifespan||40;this.borderRadius=a.borderRadius||"100%"}function G(a){var a=a||{},c=b.defaultColors.getColor("heat"),d=b.defaultColors.getColor("food"),e=new b.ColorPalette;b.Mover.call(this,
a);e.addColor({min:12,max:24,startColor:c.startColor,endColor:c.endColor}).addColor({min:12,max:24,startColor:d.startColor,endColor:d.endColor});this.beforeStep=function(){var a;if(0===this.world.clock%this.burstRate)for(a=0;a<this.burst;a+=1)new b.Particle(this.particle());0<this.lifespan?this.lifespan-=1:0===this.lifespan&&b.elementList.destroyElement(this.id)};this.lifespan=a.lifespan||-1;this.width=0===a.width?0:a.width||0;this.height=0===a.height?0:a.height||0;this.isStatic=!1===a.isStatic?!1:
a.isStatic||!0;this.burst=0===a.burst?0:a.burst||1;this.burstRate=0===a.burstRate?0:a.burstRate||3;this.particle=a.particle||function(){var a=b.config.borderStyles,a=a[b.Utils.getRandomNumber(0,a.length-1)];return{color:e.getColor(),borderWidth:b.Utils.getRandomNumber(2,12),borderStyle:a,borderColor:e.getColor(),boxShadow:"0 0 0 "+b.Utils.getRandomNumber(2,6)+"px rgb("+e.getColor().toString()+")",zIndex:b.Utils.getRandomNumber(1,100),location:this.getLocation(),acceleration:new b.Vector(b.Utils.getRandomNumber(-4,
4),b.Utils.getRandomNumber(-4,4))}}}function H(a){a=a||{};b.Mover.call(this,a);this.c=0===a.c?0:a.c||1;this.mass=0===a.mass?0:a.mass||50;this.isStatic=!1===a.isStatic?!1:a.isStatic||!0;this.width=0===a.width?0:a.width||100;this.height=0===a.height?0:a.height||100;this.opacity=0===a.opacity?0:a.opacity||0.75}function I(a){a=a||{};b.Mover.call(this,a);this.G=0===a.G?0:a.G||1;this.mass=0===a.mass?0:a.mass||100;this.isStatic=!1===a.isStatic?!1:a.isStatic||!0;this.width=0===a.width?0:a.width||50;this.height=
0===a.height?0:a.height||50;this.opacity=0===a.opacity?0:a.opacity||0.75}function J(a){a=a||{};b.Mover.call(this,a);this.G=0===a.G?0:a.G||-1;this.mass=0===a.mass?0:a.mass||100;this.isStatic=!1===a.isStatic?!1:a.isStatic||!0;this.width=0===a.width?0:a.width||50;this.height=0===a.height?0:a.height||50;this.opacity=0===a.opacity?0:a.opacity||0.75}function K(a){a=a||{};b.Mover.call(this,a);this.mass=0===a.mass?0:a.mass||50;this.isStatic=!1===a.isStatic?!1:a.isStatic||!0;this.width=0===a.width?0:a.width||
20;this.height=0===a.height?0:a.height||20;this.opacity=0===a.opacity?0:a.opacity||0.5}function L(a){a=a||{};b.Mover.call(this,a);this.mass=0===a.mass?0:a.mass||50;this.isStatic=!1===a.isStatic?!1:a.isStatic||!0;this.width=0===a.width?0:a.width||20;this.height=0===a.height?0:a.height||20;this.opacity=0===a.opacity?0:a.opacity||0.5}function M(a){a=a||{};b.Mover.call(this,a);this.mass=0===a.mass?0:a.mass||50;this.isStatic=!1===a.isStatic?!1:a.isStatic||!0;this.width=0===a.width?0:a.width||20;this.height=
0===a.height?0:a.height||20;this.opacity=0===a.opacity?0:a.opacity||0.5}function N(a){a=a||{};b.Mover.call(this,a);this.mass=0===a.mass?0:a.mass||50;this.isStatic=!1===a.isStatic?!1:a.isStatic||!0;this.width=0===a.width?0:a.width||20;this.height=0===a.height?0:a.height||20;this.opacity=0===a.opacity?0:a.opacity||0.5}function O(a){a=a||{};b.Mover.call(this,a);this.mass=0===a.mass?0:a.mass||50;this.isStatic=!1===a.isStatic?!1:a.isStatic||!0;this.width=0===a.width?0:a.width||20;this.height=0===a.height?
0:a.height||20;this.opacity=0===a.opacity?0:a.opacity||0.5}function P(a){a=a||{};b.Mover.call(this,a);this.mass=0===a.mass?0:a.mass||50;this.isStatic=!1===a.isStatic?!1:a.isStatic||!0;this.width=0===a.width?0:a.width||75;this.height=0===a.height?0:a.height||75;this.opacity=0===a.opacity?0:a.opacity||0.5}function x(a){a=a||{};b.Mover.call(this,a);this.type=a.type||"";this.behavior=a.behavior||"LOVE";this.sensitivity=0===a.sensitivity?0:a.sensitivity||2;this.width=0===a.width?0:a.width||5;this.height=
0===a.height?0:a.height||5;this.offsetDistance=0===a.offsetDistance?0:a.offsetDistance||30;this.offsetAngle=a.offsetAngle||0;this.opacity=0===a.opacity?0:a.opacity||1;this.target=a.target||null;this.activated=!!a.activated}function V(a){var c,d;if(b.Interface.checkRequiredParams(a,{location:"object",scale:"number",angle:"number",opacity:"number",width:"number",height:"number",colorMode:"string",color:"array"}))return c=document.createElement("div"),d=document.createElement("div"),c.className="flowFieldMarker floraElement",
d.className="nose",c.appendChild(d),c.style.cssText=b.Utils.getCSSText({x:a.location.x-a.width/2,y:a.location.y-a.height/2,s:a.scale,a:a.angle,o:a.opacity,w:a.width,h:a.height,cm:a.colorMode,color:a.color,z:a.zIndex,borderWidth:a.borderWidth,borderStyle:a.borderStyle,borderColor:a.borderColor,borderRadius:a.borderRadius,boxShadow:a.boxShadow}),c}function Q(a){a=a||{};this.resolution=a.resolution||50;this.perlinSpeed=a.perlinSpeed||0.01;this.perlinTime=a.perlinTime||100;this.field=a.field||null;this.createMarkers=
a.createMarkers||!1;this.world=a.world||b.universe.first()}function E(a){a=a||{};b.Mover.call(this,a);this.width=0===a.width?0:a.width||10;this.height=0===a.height?0:a.height||1;this.opacity=0===a.opacity?0:a.opacity||1;this.zIndex=a.zIndex||0;this.parentA=a.parentA||null;this.parentB=a.parentB||null;this.color="transparent"}function R(a){a=a||{};b.Mover.call(this,a);this.width=0===a.width?0:a.width||10;this.height=0===a.height?0:a.height||10;this.opacity=0===a.opacity?0:a.opacity||0.5;this.isStatic=
!1===a.isStatic?!1:a.isStatic||!0;this.zIndex=0===a.zIndex?0:a.zIndex||0;this.offsetAngle=a.offsetAngle||0;this.length=0===a.length?0:a.length||30}function S(a){a=a||{};this.world=a.world||b.universe.first();this.position=a.position||"top left";this.text=a.text||"";this.opacity=0===a.opacity?0:a.opacity||0.75;this.borderWidth=a.borderWidth||"1px";this.borderStyle=a.borderStyle||"solid";this.borderColor=a.borderColor||[204,204,204];this.colorMode=a.colorMode||"rgb";this._el=document.createElement("div");
this._el.id="caption";this._el.className="caption "+this.position;this._el.style.opacity=this.opacity;this._el.style.borderWidth=this.borderWidth;this._el.style.borderStyle=this.borderStyle;this._el.style.borderColor="string"===typeof this.borderColor?this.borderColor:this.colorMode+"("+this.borderColor[0]+", "+this.borderColor[1]+", "+this.borderColor[2]+")";this._el.appendChild(document.createTextNode(this.text));document.getElementById("caption")&&document.getElementById("caption").parentNode.removeChild(document.getElementById("caption"));
this.world.el.appendChild(this._el)}function F(){var a,c;Date.now&&(this._fps=0,this._timeLastSecond=this._timeLastFrame=this._time=Date.now(),this._frameCount=0,this._el=document.createElement("div"),this._el.id="statsDisplay",this._el.className="statsDisplay",this._el.style.color="white",this._fpsValue=this._totalElementsValue=null,a=document.createElement("span"),a.className="statsDisplayLabel",c=document.createTextNode("total elements: "),a.appendChild(c),this._el.appendChild(a),this._totalElementsValue=
document.createTextNode("0"),this._el.appendChild(this._totalElementsValue),a=document.createElement("span"),a.className="statsDisplayLabel",c=document.createTextNode("fps: "),a.appendChild(c),this._el.appendChild(a),this._fpsValue=document.createTextNode("0"),this._el.appendChild(this._fpsValue),document.body.appendChild(this._el),this._update())}window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||
window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)};b.config={borderStyles:"none solid dotted dashed double inset outset groove ridge".split(" "),defaultColorList:[{name:"heat",startColor:[255,132,86],endColor:[175,47,0]},{name:"cold",startColor:[88,129,135],endColor:[171,244,255]},{name:"food",startColor:[186,255,130],endColor:[84,187,0]},{name:"oxygen",startColor:[109,215,255],endColor:[0,140,192]},{name:"light",startColor:[255,227,127],endColor:[189,148,0]}],keyMap:{toggleWorldPlaystate:80,
resetSystem:82,toggleStatsDisplay:83,thrustLeft:37,thrustUp:38,thrustRight:39,thrustDown:40}};n.prototype.name="elementlist";n.prototype.add=function(a){this._records.push(a);return this._records};n.prototype.all=function(){return this._records};n.prototype.count=function(){return this._records.length};n.prototype.getAllByClass=function(a){var c,b,e=[];c=0;for(b=this._records.length;c<b;c++)this._records[c].constructor.name===a&&(e[e.length]=this._records[c]);return e};n.prototype.updatePropsByClass=
function(a,c){var b,e,f,g=this.getAllByClass(a);b=0;for(e=g.length;b<e;b++)for(f in c)c.hasOwnProperty(f)&&(g[b][f]=c[f]);return g};n.prototype.getElement=function(a){var c,b,e=this._records;c=0;for(b=e.length;c<b;c+=1)if(e[c].id===a)return e[c]};n.prototype.destroyElement=function(a){var b,d,e=this._records;b=0;for(d=e.length;b<d;b+=1)if(e[b].id===a){e[b].world.el.removeChild(e[b].el);e.splice(b,1);break}};n.prototype.destroyAll=function(){var a,b=this._records;for(a=b.length-1;0<=a;a-=1)b[a].world&&
b[a].world.el.removeChild(b[a].el);this._records=[]};n.prototype.destroyByWorld=function(a){var b,d=this._records;for(b=d.length-1;0<=b;b-=1)d[b].world&&d[b].world.id===a&&(d[b].world.el.removeChild(d[b].el),d.splice(b,1))};b.ElementList=n;w.prototype.name="florasystem";w.setup=null;w.prototype.start=function(a){a="function"===b.Interface.getDataType(a)?a:function(){};w.setup=a;a();b.animLoop()};w.prototype.destroy=function(){b.elementList.destroyAll()};b.System=w;b.Utils={extend:function(a,b){function d(){}
d.prototype=b.prototype;a.prototype=new d;a.prototype.constructor=a},map:function(a,b,d,e,f){return(a-b)/(d-b)*(f-e)+e},getRandomNumber:function(a,b,d){return d?Math.random()*(b-(a-1))+a:Math.floor(Math.random()*(b-(a-1)))+a},degreesToRadians:function(a){if("undefined"!==typeof a)return 2*Math.PI*(a/360);"undefined"!==typeof console&&console.log("Error: Utils.degreesToRadians is missing degrees param.");return!1},radiansToDegrees:function(a){if("undefined"!==typeof a)return a*(180/Math.PI);"undefined"!==
typeof console&&console.log("Error: Utils.radiansToDegrees is missing radians param.");return!1},constrain:function(a,b,d){return a>d?d:a<b?b:a},clone:function(a){function b(){}b.prototype=a;return new b},addEvent:function(a,b,d){a.addEventListener?this.addEventHandler=function(a,b,c){a.addEventListener(b,c,!1)}:a.attachEvent&&(this.addEventHandler=function(a,b,c){a.attachEvent("on"+b,c)});this.addEventHandler(a,b,d)},log:function(a){"undefined"!==typeof console&&"undefined"!==typeof console.log?
(this.log=function(a){console.log(a)},this.log.call(this,a)):this.log=function(){}},getWindowSize:function(){var a={width:!1,height:!1};"undefined"!==typeof window.innerWidth?a.width=window.innerWidth:"undefined"!==typeof document.documentElement&&"undefined"!==typeof document.documentElement.clientWidth?a.width=document.documentElement.clientWidth:"undefined"!==typeof document.body&&(a.width=document.body.clientWidth);"undefined"!==typeof window.innerHeight?a.height=window.innerHeight:"undefined"!==
typeof document.documentElement&&"undefined"!==typeof document.documentElement.clientHeight?a.height=document.documentElement.clientHeight:"undefined"!==typeof document.body&&(a.height=document.body.clientHeight);return a},getCSSText:function(a){var b="";a.color?a.background=a.cm+"("+a.color[0]+", "+a.color[1]+", "+a.color[2]+")":(a.color=[],a.background=null);a.borderColor?a.borderColorStr=a.cm+"("+a.borderColor[0]+", "+a.borderColor[1]+", "+a.borderColor[2]+")":(a.borderColor=[],a.borderColorStr=
"");b=Modernizr.csstransforms3d?["-webkit-transform: translateX("+a.x+"px) translateY("+a.y+"px) translateZ(0) rotate("+a.a+"deg) scaleX("+a.s+") scaleY("+a.s+")","-moz-transform: translateX("+a.x+"px) translateY("+a.y+"px) translateZ(0) rotate("+a.a+"deg) scaleX("+a.s+") scaleY("+a.s+")","-o-transform: translateX("+a.x+"px) translateY("+a.y+"px) translateZ(0) rotate("+a.a+"deg) scaleX("+a.s+") scaleY("+a.s+")"].join(";"):Modernizr.csstransforms?["-webkit-transform: translateX("+a.x+"px) translateY("+
a.y+"px) rotate("+a.a+"deg) scaleX("+a.s+") scaleY("+a.s+")","-moz-transform: translateX("+a.x+"px) translateY("+a.y+"px) rotate("+a.a+"deg) scaleX("+a.s+") scaleY("+a.s+")","-o-transform: translateX("+a.x+"px) translateY("+a.y+"px) rotate("+a.a+"deg) scaleX("+a.s+") scaleY("+a.s+")"].join(";"):["position: absolute","left: "+a.x+"px","top: "+a.y+"px"].join(";");return[b,"opacity: "+a.o,"width: "+a.w+"px","height: "+a.h+"px","background: "+a.background,"z-index: "+a.z,"border-width: "+a.borderWidth+
"px","border-style: "+a.borderStyle,"border-color: "+a.borderColorStr,"border-radius: "+a.borderRadius,"box-shadow: "+a.boxShadow].join(";")}};i.VectorSub=function(a,b){return new i(a.x-b.x,a.y-b.y)};i.VectorAdd=function(a,b){return new i(a.x+b.x,a.y+b.y)};i.VectorMult=function(a,b){return new i(a.x*b,a.y*b)};i.VectorDiv=function(a,b){return new i(a.x/b.x,a.y/b.y)};i.VectorMidPoint=function(a,b){return this.VectorAdd(a,b).div(2)};i.VectorAngleBetween=function(a,b){var d=a.dot(b);return Math.acos(d/
(a.mag()*b.mag()))};i.prototype.clone=function(){function a(){}a.prototype=this;return new a};i.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};i.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;return this};i.prototype.mult=function(a){this.x*=a;this.y*=a;return this};i.prototype.div=function(a){this.x/=a;this.y/=a;return this};i.prototype.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};i.prototype.limit=function(a){this.mag()>a&&(this.normalize(),this.mult(a));return this};
i.prototype.limitLow=function(a){this.mag()<a&&(this.normalize(),this.mult(a));return this};i.prototype.normalize=function(){var a=this.mag();if(0!==a)return this.div(a)};i.prototype.distance=function(a){return Math.sqrt(Math.pow(a.x-this.x,2)+Math.pow(a.y-this.y,2))};i.prototype.rotate=function(a){var b=Math.cos(a),a=Math.sin(a),d=this.x,e=this.y;this.x=d*b-e*a;this.y=d*a+e*b;return this};i.prototype.midpoint=function(a,b){return this.VectorAdd(a,b).div(2)};i.prototype.dot=function(a){return this.z&&
a.z?this.x*a.x+this.y*a.y+this.z*a.z:this.x*a.x+this.y*a.y};b.Vector=i;u.prototype.name="colorpalette";u.prototype.addColor=function(a){var c,d;if(b.Interface.checkRequiredParams(a,{min:"number",max:"number",startColor:"array",endColor:"array"})){c=b.Utils.getRandomNumber(a.min,a.max);d=u._createColorRange(a.startColor,a.endColor,255);for(a=0;a<c;a++)this._colors.push(d[b.Utils.getRandomNumber(0,d.length-1)])}return this};u.prototype.createGradient=function(a){if(b.Interface.checkRequiredParams(a,
{startColor:"array",endColor:"array"}))if(this.startColor=a.startColor,this.endColor=a.endColor,this.totalColors=a.totalColors||255,0<this.totalColors)this._gradients.push(u._createColorRange(this.startColor,this.endColor,this.totalColors));else throw Error("ColorPalette: total colors must be greater than zero.");};u.prototype.getColor=function(){if(0<this._colors.length)return this._colors[b.Utils.getRandomNumber(0,this._colors.length-1)];throw Error("ColorPalette.getColor: You must add colors via addColor() before using getColor().");
};u.prototype.createSampleStrip=function(a){var b,d,e;b=0;for(d=this._colors.length;b<d;b++)e=document.createElement("div"),e.className="color-sample-strip",e.style.background="rgb("+this._colors[b].toString()+")",a.appendChild(e)};u._createColorRange=function(a,b,d){var e,f=[],g=a[0],h=a[1],a=a[2],r=b[1];e=b[2];var A,i,k,j,b=b[0]-g,r=r-h;A=e-a;for(e=0;e<d;e++)i=parseInt(b*e/d,10)+g,k=parseInt(r*e/d,10)+h,j=parseInt(A*e/d,10)+a,f.push([i,k,j]);return f};b.ColorPalette=u;y.prototype.addColor=function(a){b.Interface.checkRequiredParams(a,
{name:"string",startColor:"array",endColor:"array"})&&(this[a.name]={startColor:a.startColor,endColor:a.endColor});return this};y.prototype.name="colortable";y.prototype.getColor=function(a,c,d){var e,f;if("string"===b.Interface.getDataType(a))if(this[a]){a=this[a];c&&(e=a.startColor);d&&(f=a.endColor);if(e&&f||!e&&!f)return{startColor:a.startColor,endColor:a.endColor};if(e)return e;if(f)return f}else throw Error("ColorTable: "+a+" does not exist. Add colors to the ColorTable via addColor().");else throw Error("ColorTable: You must pass a name (string) for the color entry in the table.");
};b.ColorTable=y;z.prototype.name="borderpalette";z.prototype.addBorder=function(a){var c,d;if(b.Interface.checkRequiredParams(a,{min:"number",max:"number",style:"string"})){d=b.Utils.getRandomNumber(a.min,a.max);for(c=0;c<d;c++)this._borders.push(a.style)}return this};z.prototype.getBorder=function(){if(0<this._borders.length)return this._borders[b.Utils.getRandomNumber(0,this._borders.length-1)];throw Error("BorderPalette.getBorder: You must add borders via addBorder() before using getBorder().");
};b.BorderPalette=z;var v={random:function(){return 0.1}};void 0===v&&(v=Math);var o,T=[];for(o=0;256>o;o+=1)T[o]=Math.floor(256*v.random());v=[];for(o=0;512>o;o+=1)v[o]=T[o&255];b.SimplexNoise={grad3:[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],p:T,perm:v,simplex:[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],
[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]],dot:function(a,b,d){return a[0]*
b+a[1]*d},noise:function(a,b){var d,e,f;f=0.5*(Math.sqrt(3)-1);f*=a+b;var g=Math.floor(a+f),h=Math.floor(b+f),r=(3-Math.sqrt(3))/6;f=(g+h)*r;d=a-(g-f);var i=b-(h-f),l,k;d>i?(l=1,k=0):(l=0,k=1);e=d-l+r;var j=i-k+r;f=d-1+2*r;var r=i-1+2*r,s=g&255,h=h&255,g=this.perm[s+this.perm[h]]%12;l=this.perm[s+l+this.perm[h+k]]%12;k=this.perm[s+1+this.perm[h+1]]%12;h=0.5-d*d-i*i;0>h?d=0:(h*=h,d=h*h*this.dot(this.grad3[g],d,i));i=0.5-e*e-j*j;0>i?e=0:(i*=i,e=i*i*this.dot(this.grad3[l],e,j));j=0.5-f*f-r*r;0>j?f=0:
(j*=j,f=j*j*this.dot(this.grad3[k],f,r));return 70*(d+e+f)},noise3d:function(a,b,d){var e,f,g,h=(a+b+d)*(1/3),i=Math.floor(a+h),l=Math.floor(b+h),p=Math.floor(d+h),h=1/6;g=(i+l+p)*h;e=a-(i-g);f=b-(l-g);var k=d-(p-g),j,s,m,n,t,q;e>=f?f>=k?(j=1,m=s=0,t=n=1,q=0):(e>=k?(j=1,m=s=0):(s=j=0,m=1),n=1,t=0,q=1):f<k?(s=j=0,m=1,n=0,q=t=1):e<k?(j=0,s=1,n=m=0,q=t=1):(j=0,s=1,m=0,t=n=1,q=0);var o=e-j+h,u=f-s+h,w=k-m+h;g=e-n+2*h;var a=f-t+2*h,x=k-q+2*h,d=e-1+3*h,b=f-1+3*h,h=k-1+3*h,i=i&255,v=l&255,y=p&255,l=this.perm[i+
this.perm[v+this.perm[y]]]%12,p=this.perm[i+j+this.perm[v+s+this.perm[y+m]]]%12;n=this.perm[i+n+this.perm[v+t+this.perm[y+q]]]%12;i=this.perm[i+1+this.perm[v+1+this.perm[y+1]]]%12;t=0.6-e*e-f*f-k*k;0>t?e=0:(t*=t,e=t*t*this.dot(this.grad3[l],e,f,k));f=0.6-o*o-u*u-w*w;0>f?f=0:(f*=f,f=f*f*this.dot(this.grad3[p],o,u,w));o=0.6-g*g-a*a-x*x;0>o?g=0:(o*=o,g=o*o*this.dot(this.grad3[n],g,a,x));a=0.6-d*d-b*b-h*h;0>a?d=0:(a*=a,d=a*a*this.dot(this.grad3[i],d,b,h));return 32*(e+f+g+d)}};b.Interface={checkRequiredParams:function(a,
b,d){var e,f,g=!0;for(e in b)if(b.hasOwnProperty(e))try{if("undefined"===typeof a)throw Error("checkRequiredOptions: No options were passed.");if(!this.checkDataType(this.getDataType(a[e]),b[e].split("|"))||""===a[e])throw g=!1,f=""===a[e]?'checkRequiredOptions: required option "'+e+'" is empty.':"undefined"===typeof a[e]?'checkRequiredOptions: required option "'+e+'" is missing from passed options.':'checkRequiredOptions: passed option "'+e+'" must be type '+b[e]+". Passed as "+this.getDataType(a[e])+
".",Error(f);}catch(h){console.log("ERROR: "+h.message+(d?" from: "+d:""))}return g},checkDataType:function(a,b){var d,e;d=0;for(e=b.length;d<e;d++)if(a===b[d])return!0;return!1},getDataType:function(a){return"[object Array]"===Object.prototype.toString.call(a)?"array":"[object NodeList]"===Object.prototype.toString.call(a)?"nodeList":typeof a}};p.prototype.name="universe";p.prototype.addWorld=function(a){this._records.push(new b.World(a||{}));b.elementList.add(this._records[this._records.length-
1]);return this._records};p.prototype.first=function(){return this._records[0]?this._records[0]:null};p.prototype.last=function(){return this._records[this._records.length-1]?this._records[this._records.length-1]:null};p.prototype.update=function(a,c){var d,e="object"===b.Interface.getDataType(a)?a:{},f;if(c)if("string"===b.Interface.getDataType(c))f=this.getWorldById(c);else if("object"===b.Interface.getDataType(c))f=c;else{b.Utils.log("Universe: update: world param must be null, a string (an id) or reference to a world.");
return}else f=this.first();for(d in e)e.hasOwnProperty(d)&&(f[d]=e[d]);e.el&&(f.width=parseInt(f.el.style.width.replace("px",""),10),f.height=parseInt(f.el.style.height.replace("px",""),10))};p.prototype.all=function(){return this._records};p.prototype.count=function(){return this._records.length};p.prototype.getWorldById=function(a){var b,d,e=this._records;b=0;for(d=e.length;b<d;b+=1)if(e[b].id===a)return e[b];return null};p.prototype.destroyWorld=function(a){var c,d,e=this._records;c=0;for(d=e.length;c<
d;c+=1)if(e[c].id===a){a=e[c].el.parentNode;e[c].el===document.body?b.elementList.destroyAll():(b.elementList.destroyByWorld(e[c]),a.removeChild(e[c].el));e.splice(c,1);break}};p.prototype.destroyAll=function(){b.elementList.destroyAll();for(var a=this._records.length-1;0<=a;a-=1)this.destroyWorld(this._records[a].id)};p.prototype.updateClocks=function(){for(var a=0,b=this._records.length;a<b;a+=1)this._records[a].clock+=1};p.prototype.createStats=function(){this._statsDisplay=new b.StatsDisplay};
p.prototype.destroyStats=function(){var a=document.getElementById("statsDisplay");this._statsDisplay=null;a&&a.parentNode.removeChild(a)};b.Universe=p;m.prototype.name="world";m._idCount=0;m.prototype.configure=function(a){this.el=a||null||document.body;this.el.style.width=this.width+"px";this.el.style.height=this.height+"px"};m.prototype.update=function(a){var c,d,e="",a="object"===b.Interface.getDataType(a)?a:{};for(d in a)a.hasOwnProperty(d)&&(this[d]=a[d]);a.el&&(this.width=parseInt(this.el.style.width.replace("px",
""),10),this.height=parseInt(this.el.style.height.replace("px",""),10));if(this.el.style.setAttribute){if(a.style)for(c in a.style)a.style.hasOwnProperty(c)&&(e=e+c+": "+a.style[c]+";");this.el.style.setAttribute("cssText",e,0)}else if(a.style)for(c in a.style)a.style.hasOwnProperty(c)&&(this.el.style[c]=a.style[c],e=e+c+": "+a.style[c]+";")};m.prototype.resize=function(){var a,c,d;a=b.Utils.getWindowSize();var e=a.width,f=a.height,g=b.elementList.all();a=0;for(c=g.length;a<c;a+=1)if(g[a].controlCamera){d=
!0;break}if(!d){a=0;for(c=g.length;a<c;a+=1)d=g[a].location,d.x=e*(d.x/this.width),d.y=f*(d.y/this.height);this.el===document.body&&(this.width=e,this.height=f)}};m.prototype.devicemotion=function(a){this.gravity=0===window.orientation?this.isTopDown?new b.Vector(a.accelerationIncludingGravity.x,-1*a.accelerationIncludingGravity.y):new b.Vector(a.accelerationIncludingGravity.x,2*(a.accelerationIncludingGravity.z+7.5)):-90===window.orientation?new b.Vector(a.accelerationIncludingGravity.y,a.accelerationIncludingGravity.x):
new b.Vector(-1*a.accelerationIncludingGravity.y,-1*a.accelerationIncludingGravity.x);this.showDeviceOrientation&&document.getElementById("compassDisplay").val("orientation: "+window.orientation+" x: "+a.accelerationIncludingGravity.x.toFixed(2)+" y: "+a.accelerationIncludingGravity.y.toFixed(2)+" z: "+a.accelerationIncludingGravity.z.toFixed(2))};m.prototype.deviceorientation=function(a){var b=a.webkitCompassHeading;this.compassAccuracy=a=a.webkitCompassAccuracy;this.compassHeading=b;this.showCompassHeading&&
document.getElementById("compassDisplay").val("heading: "+b.toFixed(2)+" accuracy: +/- "+a)};m.prototype.step=function(){this.beforeStep&&this.beforeStep.apply(this);this.afterStep&&this.afterStep.apply(this)};m.prototype.draw=function(){if(b.camera.controlObj||!(this.isStatic&&0<this.clock))this.el.style.cssText=b.Utils.getCSSText({x:this.location.x,y:this.location.y,s:this.scale,a:this.angle,o:this.opacity,w:this.width,h:this.height,cm:this.colorMode,color:this.color,z:this.zIndex,borderWidth:this.borderWidth,
borderStyle:this.borderStyle,borderColor:this.borderColor,borderRadius:this.borderRadius,boxShadow:this.boxShadow})};b.World=m;U.prototype.name="camera";b.Camera=U;q.events=["mouseenter","mousedown","mousemove","mouseup","mouseleave"];q.prototype.name="obj";q.mouseover=function(){this.isMouseOut=!1;clearInterval(this.mouseOutInterval)};q.mousedown=function(a){var b=a.target;this.isPressed=!0;this.isMouseOut=!1;this.offsetX=a.pageX-b.offsetLeft;this.offsetY=a.pageY-b.offsetTop};q.mousemove=function(a){var c;
this.isPressed&&(this.isMouseOut=!1,c=a.pageX-this.world.el.offsetLeft,a=a.pageY-this.world.el.offsetTop,q.mouseIsInsideWorld(this.world)?this.location=new b.Vector(c,a):this.isPressed=!1)};q.mouseup=function(){this.isPressed=!1};q.mouseout=function(){var a=this,c,d;this.isPressed&&(this.isMouseOut=!0,this.mouseOutInterval=setInterval(function(){a.isPressed&&a.isMouseOut&&(c=b.mouse.loc.x-a.world.el.offsetLeft,d=b.mouse.loc.y-a.world.el.offsetTop,a.location=new b.Vector(c,d))},16))};q.mouseIsInsideWorld=
function(a){var c=b.mouse.loc.x,d=b.mouse.loc.y;return a&&c>a.location.x&&c<a.location.x+a.width&&d>a.location.y&&d<a.location.y+a.height?!0:!1};q.prototype.draw=function(){this.el.style.cssText=b.Utils.getCSSText({x:this.location.x-this.width/2,y:this.location.y-this.height/2,s:this.scale,a:this.angle,o:this.opacity,w:this.width,h:this.height,cm:this.colorMode,color:this.color,z:this.zIndex,borderWidth:this.borderWidth,borderStyle:this.borderStyle,borderColor:this.borderColor,borderRadius:this.borderRadius,
boxShadow:this.boxShadow})};b.Obj=q;b.Utils.extend(l,b.Obj);l.prototype.name="mover";l._idCount=0;l.prototype.step=function(){var a,c,d,e,f,g,h=this.world,i=b.elementList.all();this.beforeStep&&this.beforeStep.apply(this);if(!this.isStatic&&!this.isPressed){if(0<b.liquids.length){a=0;for(c=b.liquids.length;a<c;a+=1)this.id!==b.liquids[a].id&&this.isInside(b.liquids[a])&&(d=this.drag(b.liquids[a]),this.applyForce(d))}if(0<b.repellers.length){a=0;for(c=b.repellers.length;a<c;a+=1)this.id!==b.repellers[a].id&&
(d=this.attract(b.repellers[a]),this.applyForce(d))}if(0<b.attractors.length){a=0;for(c=b.attractors.length;a<c;a+=1)this.id!==b.attractors[a].id&&(d=this.attract(b.attractors[a]),this.applyForce(d))}if(0<this.sensors.length){a=0;for(c=this.sensors.length;a<c;a+=1)g=this.sensors[a],e=g.offsetDistance,f=b.Utils.degreesToRadians(this.angle+g.offsetAngle),d=e*Math.cos(f),e*=Math.sin(f),g.location.x=this.location.x,g.location.y=this.location.y,g.location.add(new b.Vector(d,e)),g.activated&&this.applyForce(g.getActivationForce({mover:this}))}h.c&&
(a=b.Utils.clone(this.velocity),a.mult(-1),a.normalize(),a.mult(h.c),this.applyForce(a));this.applyForce(h.wind);this.applyForce(h.gravity);this.followMouse&&(a={location:new b.Vector(b.mouse.loc.x,b.mouse.loc.y)},this.applyForce(this.seek(a)));this.target&&this.applyForce(this.seek(this.target));this.flowField&&(c=this.flowField.resolution,a=Math.floor(this.location.x/c),c=Math.floor(this.location.y/c),this.flowField.field[a]&&(a=(a=this.flowField.field[a][c])?{location:new b.Vector(a.x,a.y)}:{location:new b.Vector(this.location.x,
this.location.y)},this.applyForce(this.follow(a))));this.flocking&&this.flock(i);this.velocity.add(this.acceleration);this.maxSpeed&&this.velocity.limit(this.maxSpeed);this.minSpeed&&this.velocity.limitLow(this.minSpeed);this.location.add(this.velocity);this.pointToDirection&&0.1<this.velocity.mag()&&(this.angle=b.Utils.radiansToDegrees(Math.atan2(this.velocity.y,this.velocity.x)));this.controlCamera&&this.checkCameraEdges();(this.checkEdges||this.wrapEdges)&&this.checkWorldEdges(h);this.parent&&
(this.offsetDistance?(e=this.offsetDistance,f=b.Utils.degreesToRadians(this.parent.angle+this.offsetAngle),d=e*Math.cos(f),e*=Math.sin(f),this.location.x=this.parent.location.x,this.location.y=this.parent.location.y,this.location.add(new b.Vector(d,e))):this.location=this.parent.location);this.afterStep&&this.afterStep.apply(this);this.acceleration.mult(0);0<this.lifespan&&(this.lifespan-=1)}};l.prototype.applyForce=function(a){a=a.clone();a.div(this.mass);this.acceleration.add(a)};l.prototype.seek=
function(a){var c=this.world,a=b.Vector.VectorSub(a.location,this.location),d=a.mag();a.normalize();d<c.width/2?(c=b.Utils.map(d,0,c.width/2,0,this.maxSpeed),a.mult(c)):a.mult(this.maxSpeed);c=b.Vector.VectorSub(a,this.velocity);c.limit(this.maxSteeringForce);return c};l.prototype.follow=function(a){a=a.location;a.mult(this.maxSpeed);a=b.Vector.VectorSub(a,this.velocity);a.limit(this.maxSteeringForce);return a};l.prototype.flock=function(a){this.applyForce(this.separate(a).mult(this.separateStrength));
this.applyForce(this.align(a).mult(this.alignStrength));this.applyForce(this.cohesion(a).mult(this.cohesionStrength))};l.prototype.separate=function(a){var c,d,e,f,g=new b.Vector,h=0;c=0;for(d=a.length;c<d;c+=1)e=a[c],this.className===e.className&&this.id!==e.id&&(f=this.location.distance(e.location),0<f&&f<this.desiredSeparation&&(e=b.Vector.VectorSub(this.location,e.location),e.normalize(),e.div(f),g.add(e),h+=1));return 0<h?(g.div(h),g.normalize(),g.mult(this.maxSpeed),a=b.Vector.VectorSub(g,this.velocity),
a.limit(this.maxSteeringForce),a):new b.Vector};l.prototype.align=function(a){var c,d,e,f,g=new b.Vector,h=2*this.width,i=0;c=0;for(d=a.length;c<d;c+=1)e=a[c],f=this.location.distance(e.location),0<f&&f<h&&(this.className===e.className&&this.id!==e.id)&&(g.add(e.velocity),i+=1);return 0<i?(g.div(i),g.normalize(),g.mult(this.maxSpeed),a=b.Vector.VectorSub(g,this.velocity),a.limit(this.maxSteeringForce),a):new b.Vector};l.prototype.cohesion=function(a){var c,d,e,f,g=new b.Vector,h=0;c=0;for(d=a.length;c<
d;c+=1)e=a[c],f=this.location.distance(e.location),0<f&&10>f&&(this.className===e.className&&this.id!==e.id)&&(g.add(e.location),h+=1);return 0<h?(g.div(h),a=b.Vector.VectorSub(g,this.location),a.normalize(),a.mult(this.maxSpeed),a=b.Vector.VectorSub(a,this.velocity),a.limit(this.maxSteeringForce),a):new b.Vector};l.prototype.flee=function(a){a=b.Vector.VectorSub(a.location,this.location);a.normalize();a.mult(-this.maxSpeed);return a};l.prototype.drag=function(a){var c=this.velocity.mag(),a=-1*a.c*
c*c,c=b.Utils.clone(this.velocity);c.normalize();c.mult(a);return c};l.prototype.attract=function(a){var c=b.Vector.VectorSub(a.location,this.location),d;d=c.mag();d=b.Utils.constrain(d,this.width*this.height/8,a.width*a.height);c.normalize();c.mult(a.G*a.mass*this.mass/(d*d));return c};l.prototype.isInside=function(a){return a&&this.location.x+this.width/2>a.location.x-a.width/2&&this.location.x-this.width/2<a.location.x+a.width/2&&this.location.y+this.height/2>a.location.y-a.height/2&&this.location.y-
this.height/2<a.location.y+a.height/2?!0:!1};l.prototype.checkWorldEdges=function(a){var c=this.location.x,d=this.location.y,e,f=!1,g;this.wrapEdges?this.location.x>a.width?(this.location=new b.Vector(0,this.location.y),g=new b.Vector(c-this.location.x,0),f=!0):0>this.location.x&&(this.location=new b.Vector(a.width,this.location.y),g=new b.Vector(c-this.location.x,0),f=!0):(this.avoidEdges&&(this.location.x<this.avoidEdgesStrength?e=this.maxSpeed:this.location.x>b.world.width-this.avoidEdgesStrength&&
(e=-this.maxSpeed),e&&(e=new b.Vector(e,this.velocity.y),e=b.Vector.VectorSub(e,this.velocity),e.limit(this.maxSteeringForce),this.applyForce(e))),this.location.x+this.width/2>a.width)?(this.location=new b.Vector(a.width-this.width/2,this.location.y),g=new b.Vector(c-this.location.x,0),this.velocity.x*=-1*this.bounciness,f=!0):this.location.x<this.width/2&&(this.location=new b.Vector(this.width/2,this.location.y),g=new b.Vector(c-this.location.x,0),this.velocity.x*=-1*this.bounciness,f=!0);e=null;
this.wrapEdges?this.location.y>a.height?(this.location=new b.Vector(this.location.x,0),g=new b.Vector(0,d-this.location.y),f=!0):0>this.location.y&&(this.location=new b.Vector(this.location.x,a.height),g=new b.Vector(0,d-this.location.y),f=!0):(this.avoidEdges&&(this.location.y<this.avoidEdgesStrength?e=this.maxSpeed:this.location.y>b.world.height-this.avoidEdgesStrength&&(e=-this.maxSpeed),e&&(e=new b.Vector(this.velocity.x,e),e=b.Vector.VectorSub(e,this.velocity),e.limit(this.maxSteeringForce),
this.applyForce(e))),this.location.y+this.height/2>a.height)?(this.location=new b.Vector(this.location.x,a.height-this.height/2),g=new b.Vector(0,d-this.location.y),this.velocity.y*=-1*this.bounciness,f=!0):this.location.y<this.height/2&&(this.location=new b.Vector(this.location.x,this.height/2),g=new b.Vector(0,d-this.location.y),this.velocity.y*=-1*this.bounciness,f=!0);f&&this.controlCamera&&a.location.add(g);return f};l.prototype.checkCameraEdges=function(){var a=this.velocity.clone();this.world.location.add(a.mult(-1))};
l.prototype.getLocation=function(a){if(a){if("x"===a)return this.location.x;if("y"===a)return this.location.y}else return new b.Vector(this.location.x,this.location.y)};l.prototype.getVelocity=function(a){if(a){if("x"===a)return this.velocity.x;if("y"===a)return this.velocity.y}else return new b.Vector(this.velocity.x,this.velocity.y)};b.Mover=l;b.Utils.extend(B,b.Mover);B.prototype.name="walker";B.prototype.step=function(){var a=this.world,c;this.beforeStep&&this.beforeStep.apply(this);!this.isStatic&&
!this.isPressed&&(this.isPerlin?(this.perlinTime+=this.perlinSpeed,this.remainsOnScreen?(this.acceleration=new b.Vector,this.velocity=new b.Vector.create,this.location.x=b.Utils.map(b.SimplexNoise.noise(this.perlinTime+this.offsetX,0,0.1),-1,1,0,b.world.width),this.location.y=b.Utils.map(b.SimplexNoise.noise(0,this.perlinTime+this.offsetY,0.1),-1,1,0,b.world.height)):(this.acceleration.x=b.Utils.map(b.SimplexNoise.noise(this.perlinTime+this.offsetX,0,0.1),-1,1,this.perlinAccelLow,this.perlinAccelHigh),
this.acceleration.y=b.Utils.map(b.SimplexNoise.noise(0,this.perlinTime+this.offsetY,0.1),-1,1,this.perlinAccelLow,this.perlinAccelHigh))):(a.c&&(c=b.Utils.clone(this.velocity),c.mult(-1),c.normalize(),c.mult(a.c),this.applyForce(c)),this.applyForce(a.wind),this.applyForce(a.gravity)),this.isHarmonic&&(this.velocity.x=this.harmonicAmplitude.x*Math.cos(2*Math.PI*b.world.clock/this.harmonicPeriod.x),this.velocity.y=this.harmonicAmplitude.y*Math.cos(2*Math.PI*b.world.clock/this.harmonicPeriod.y)),this.isRandom&&
(this.target={location:b.Vector.VectorAdd(this.location,new b.Vector(b.Utils.getRandomNumber(-this.randomRadius,this.randomRadius),b.Utils.getRandomNumber(-this.randomRadius,this.randomRadius)))}),this.target&&this.applyForce(this.seek(this.target)),this.velocity.add(this.acceleration),this.maxSpeed&&this.velocity.limit(this.maxSpeed),this.location.add(this.velocity),this.pointToDirection&&0.1<this.velocity.mag()&&(this.angle=b.Utils.radiansToDegrees(Math.atan2(this.velocity.y,this.velocity.x))),
this.controlCamera&&this.checkCameraEdges(),(this.checkEdges||this.wrapEdges)&&this.checkWorldEdges(a),0<this.lifespan&&(this.lifespan-=1),this.afterStep&&this.afterStep.apply(this),this.acceleration.mult(0))};b.Walker=B;b.Utils.extend(C,b.Mover);C.prototype.name="oscillator";C.prototype.step=function(){var a=this.world,c;this.beforeStep&&this.beforeStep.apply(this);if(!this.isStatic&&!this.isPressed&&(this.isPerlin?(this.perlinTime+=this.perlinSpeed,this.aVelocity.x=b.Utils.map(b.SimplexNoise.noise(this.perlinTime+
this.perlinOffsetX,0,0.1),-1,1,this.perlinAccelLow,this.perlinAccelHigh),this.aVelocity.y=b.Utils.map(b.SimplexNoise.noise(0,this.perlinTime+this.perlinOffsetY,0.1),-1,1,this.perlinAccelLow,this.perlinAccelHigh)):this.aVelocity.add(this.acceleration),this.location.x=this.initialLocation.x+Math.sin(this.aVelocity.x)*this.amplitude.x,this.location.y=this.initialLocation.y+Math.sin(this.aVelocity.y)*this.amplitude.y,this.pointToDirection&&(c=b.Vector.VectorSub(this.location,this.lastLocation),this.angle=
b.Utils.radiansToDegrees(Math.atan2(c.y,c.x))),this.controlCamera&&this.checkCameraEdges(),(this.checkEdges||this.wrapEdges)&&this.checkWorldEdges(a),0<this.lifespan&&(this.lifespan-=1),this.afterStep&&this.afterStep.apply(this),this.pointToDirection))this.lastLocation.x=this.location.x,this.lastLocation.y=this.location.y};b.Oscillator=C;b.Utils.extend(D,b.Mover);D.prototype.name="particle";D.prototype.step=function(){var a=this.world,c;this.beforeStep&&this.beforeStep.apply(this);!this.isStatic&&
!this.isPressed&&(a.c&&(c=b.Utils.clone(this.velocity),c.mult(-1),c.normalize(),c.mult(a.c),this.applyForce(c)),this.applyForce(a.wind),this.applyForce(a.gravity),(this.checkEdges||this.wrapEdges)&&this.checkWorldEdges(a),this.velocity.add(this.acceleration),this.maxSpeed&&this.velocity.limit(this.maxSpeed),this.location.add(this.velocity),this.opacity=b.Utils.map(this.lifespan,0,this.maxSpeed,0,1),this.afterStep&&this.afterStep.apply(this),0<this.lifespan?this.lifespan-=1:0===this.lifespan&&b.elementList.destroyElement(this.id),
this.acceleration.mult(0))};b.Particle=D;b.Utils.extend(G,b.Mover);G.prototype.name="particlesystem";b.ParticleSystem=G;b.Utils.extend(H,b.Mover);H.prototype.name="liquid";b.Liquid=H;b.Utils.extend(I,b.Mover);I.prototype.name="attractor";b.Attractor=I;b.Utils.extend(J,b.Mover);J.prototype.name="repeller";b.Repeller=J;b.Utils.extend(K,b.Mover);K.prototype.name="heat";b.Heat=K;b.Utils.extend(L,b.Mover);L.prototype.name="cold";b.Cold=L;b.Utils.extend(M,b.Mover);M.prototype.name="light";b.Light=M;b.Utils.extend(N,
b.Mover);N.prototype.name="oxygen";b.Oxygen=N;b.Utils.extend(O,b.Mover);O.prototype.name="food";b.Food=O;b.Utils.extend(P,b.Mover);P.prototype.name="predator";b.Predator=P;b.Utils.extend(x,b.Mover);x.prototype.name="sensor";x.prototype.step=function(){var a=!1,c,d;if("heat"===this.type&&0<b.heats.length){c=0;for(d=b.heats.length;c<d;c+=1)this.isInside(this,b.heats[c],this.sensitivity)&&(this.target=b.heats[c],a=this.activated=!0)}else if("cold"===this.type&&0<b.colds.length){c=0;for(d=b.colds.length;c<
d;c+=1)this.isInside(this,b.colds[c],this.sensitivity)&&(this.target=b.colds[c],a=this.activated=!0)}else if("predator"===this.type&&0<b.predators.length){c=0;for(d=b.predators.length;c<d;c+=1)this.isInside(this,b.predators[c],this.sensitivity)&&(this.target=b.predators[c],a=this.activated=!0)}else if("light"===this.type&&0<b.lights.length){c=0;for(d=b.lights.length;c<d;c+=1)this.isInside(this,b.lights[c],this.sensitivity)&&(this.target=b.lights[c],a=this.activated=!0)}else if("oxygen"===this.type&&
0<b.oxygen.length){c=0;for(d=b.oxygen.length;c<d;c+=1)this.isInside(this,b.oxygen[c],this.sensitivity)&&(this.target=b.oxygen[c],a=this.activated=!0)}else if("food"===this.type&&0<b.food.length){c=0;for(d=b.food.length;c<d;c+=1)this.isInside(this,b.food[c],this.sensitivity)&&(this.target=b.food[c],a=this.activated=!0)}a||(this.target=null,this.activated=!1);this.afterStep&&this.afterStep.apply(this)};x.prototype.getActivationForce=function(a){var c;switch(this.behavior){case "AGGRESSIVE":return this.seek(this.target);
case "COWARD":return this.seek(this.target).mult(-1);case "LIKES":return a=b.Vector.VectorSub(this.target.location,this.location),a.normalize(),a.mult(0.5),a;case "LOVES":var d=b.Vector.VectorSub(this.target.location,this.location);c=d.mag();d.normalize();if(c>this.width)return c/=a.mover.maxSpeed,d.mult(c),c=b.Vector.VectorSub(d,a.mover.velocity),c.limit(a.mover.maxSteeringForce),c;a.mover.velocity=new b.Vector;a.mover.acceleration=new b.Vector;a.mover.isStatic=!0;return new b.Vector;case "EXPLORER":return d=
b.Vector.VectorSub(this.target.location,this.location),c=d.mag(),d.normalize(),c/=a.mover.maxSpeed,d.mult(-c),c=b.Vector.VectorSub(d,a.mover.velocity),c.limit(0.1*a.mover.maxSteeringForce),c;case "RUN":return this.flee(this.target);case "ACCELERATE":return c=a.mover.velocity.clone(),c.normalize(),c.mult(a.mover.minSpeed);case "DECELERATE":return c=a.mover.velocity.clone(),c.normalize(),c.mult(-a.mover.minSpeed);default:return new b.Vector}};x.prototype.isInside=function(a,b,d){return a.location.x+
a.width/2>b.location.x-b.width/2-d*b.width&&a.location.x-a.width/2<b.location.x+b.width/2+d*b.width&&a.location.y+a.height/2>b.location.y-b.height/2-d*b.height&&a.location.y-a.height/2<b.location.y+b.height/2+d*b.height?!0:!1};b.Sensor=x;V.prototype.name="flowfieldmarker";b.FlowFieldMarker=V;Q.prototype.name="flowfield";Q.prototype.build=function(){var a,c,d,e,f,g,h,i,l={},m=this.world,k=Math.ceil(m.width/parseFloat(this.resolution)),j=Math.ceil(m.height/parseFloat(this.resolution)),o=this.perlinTime,
n;for(a=0;a<k;a+=1){n=this.perlinTime;l[a]={};c=0;for(d=j;c<d;c+=1)e=a*this.resolution+this.resolution/2,f=c*this.resolution+this.resolution/2,g=b.Utils.map(b.SimplexNoise.noise(o,n,0.1),0,1,0,2*Math.PI),h=Math.cos(g),i=Math.sin(g),g=new b.Vector(h,i),l[a][c]=g,h=b.Utils.radiansToDegrees(Math.atan2(i,h)),this.createMarkers&&(e=new b.FlowFieldMarker({location:new b.Vector(e,f),scale:1,opacity:b.Utils.map(h,-360,360,0.1,1),width:this.resolution,height:this.resolution/2,field:g,angle:h,colorMode:"rgb",
color:[200,100,50]}),m.el.appendChild(e)),n+=parseFloat(this.perlinSpeed);o+=parseFloat(this.perlinSpeed)}this.field=l};b.FlowField=Q;b.Utils.extend(E,b.Mover);E.prototype.name="connector";E.prototype.step=function(){var a=this.parentA.location,c=this.parentB.location;this.width=Math.floor(b.Vector.VectorSub(this.parentA.location,this.parentB.location).mag());this.location=b.Vector.VectorAdd(this.parentA.location,this.parentB.location).div(2);this.angle=b.Utils.radiansToDegrees(Math.atan2(c.y-a.y,
c.x-a.x))};b.Connector=E;b.Utils.extend(R,b.Mover);R.prototype.name="point";b.Point=R;S.prototype.name="caption";S.prototype.destroy=function(){this._el.parentNode.removeChild(this._el)};b.Caption=S;F.prototype.getFPS=function(){return this._fps};F.prototype._update=function(){var a=b.elementList.count();this._time=Date.now();this._frameCount++;this._time>this._timeLastSecond+1E3&&(this._fps=this._frameCount,this._timeLastSecond=this._time,this._frameCount=0,this._fpsValue.nodeValue=this._fps,this._totalElementsValue.nodeValue=
a);window.requestAnimFrame(this._update.bind(this))};F.prototype.name="statsDisplay";b.StatsDisplay=F})(exports);

